<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hospitable API Docs Viewer</title>

    <!-- Tailwind via CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM via CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Marked.js for Markdown rendering -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- Custom Styling (optional) -->
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="/dist/output.css" />

  </head>
  <body class="bg-gray-50 text-gray-800">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect } = React;

      function DocumentationViewer() {
        const [toc, setToc] = useState([]);
        const [selected, setSelected] = useState(null);

        useEffect(() => {
          fetch("toc_updated.json")
            .then((res) => res.json())
            .then(setToc);
        }, []);

        const handleCopy = () => {
          navigator.clipboard.writeText(selected?.content || "");
        };

        const handleDownload = () => {
          const blob = new Blob([selected?.content || ""], { type: "text/markdown" });
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = `${selected?.title || "section"}.md`;
          link.click();
        };

        const renderTOC = (items, level = 0) => (
          <ul className={`pl-${level * 4}`}>
            {items.map((item, idx) => (
              <li
                key={idx}
                className="cursor-pointer hover:underline text-sm py-1"
                onClick={() => setSelected(item)}
              >
                {item.title}
                {item.children && item.children.length > 0 && renderTOC(item.children, level + 1)}
              </li>
            ))}
          </ul>
        );

        return (
          <div className="grid grid-cols-4 gap-4 p-6">
            <div className="col-span-1 overflow-auto max-h-screen bg-white p-4 rounded shadow">
              <h2 className="font-bold text-lg mb-2">Table of Contents</h2>
              {renderTOC(toc)}
            </div>

            <div className="col-span-3 bg-white p-6 rounded shadow">
              {selected ? (
                <div>
                  <div className="flex justify-between items-start mb-4">
                    <div>
                      <h2 className="text-xl font-semibold">{selected.title}</h2>
                      {selected.url && (
                        <a
                          href={selected.url}
                          target="_blank"
                          rel="noopener noreferrer"
                          className="text-blue-600 text-sm flex items-center gap-1"
                        >
                          View Original ‚Üó
                        </a>
                      )}
                      {selected.timestamp && (
                        <p className="text-xs text-gray-500">
                          Last updated: {selected.timestamp}
                        </p>
                      )}
                    </div>
                    <div className="flex gap-2">
                      <button
                        onClick={handleCopy}
                        className="px-3 py-1 border rounded text-sm hover:bg-gray-100"
                      >
                        üìã Copy
                      </button>
                      <button
                        onClick={handleDownload}
                        className="px-3 py-1 border rounded text-sm hover:bg-gray-100"
                      >
                        ‚¨áÔ∏è Download
                      </button>
                    </div>
                  </div>

                  <div className="border rounded p-4 bg-gray-50 whitespace-pre-wrap text-sm overflow-auto">
                    <div dangerouslySetInnerHTML={{ __html: marked.parse(selected.content || "No content.") }} />
                  </div>
                </div>
              ) : (
                <p className="text-gray-500 text-sm">Select a section to view its content.</p>
              )}
            </div>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<DocumentationViewer />);
    </script>
  </body>
</html>
